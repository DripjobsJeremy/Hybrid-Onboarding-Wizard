<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DripJobs - Hybrid Onboarding Wizard (Prototype)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --dripjobs-purple: #7C3AED;
      --dripjobs-purple-dark: #6D28D9;
      --dripjobs-purple-light: #A78BFA;
      --success-green: #10B981;
    }
    .slide-enter-right { animation: slideInRight 0.3s ease-out forwards; }
    .slide-enter-left { animation: slideInLeft 0.3s ease-out forwards; }
    @keyframes slideInRight { from { opacity: 0; transform: translateX(50px); } to { opacity: 1; transform: translateX(0); } }
    @keyframes slideInLeft { from { opacity: 0; transform: translateX(-50px); } to { opacity: 1; transform: translateX(0); } }
    @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
    .fade-in { animation: fadeIn 0.3s ease-out forwards; }
    @keyframes scaleIn { 0% { transform: scale(0); opacity: 0; } 50% { transform: scale(1.1); } 100% { transform: scale(1); opacity: 1; } }
    @keyframes checkmark { 0% { transform: scale(0); } 50% { transform: scale(1.2); } 100% { transform: scale(1); } }
    .checkmark-animate { animation: checkmark 0.4s ease-out forwards; }
    @keyframes float { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-10px); } }
    .float-animation { animation: float 3s ease-in-out infinite; }
    @keyframes pulse-glow { 0%, 100% { box-shadow: 0 0 20px rgba(124, 58, 237, 0.3); } 50% { box-shadow: 0 0 40px rgba(124, 58, 237, 0.6); } }
    .pulse-glow { animation: pulse-glow 2s ease-in-out infinite; }
    @keyframes sparkle { 0%, 100% { opacity: 1; transform: scale(1); } 50% { opacity: 0.5; transform: scale(1.2); } }
    .sparkle { animation: sparkle 1.5s ease-in-out infinite; }
    @keyframes helper-bounce { 0%, 100% { transform: translateY(0) translateX(0); } 50% { transform: translateY(-5px) translateX(3px); } }
    @keyframes helper-glow { 0%, 100% { box-shadow: 0 4px 20px rgba(251, 191, 36, 0.4), 0 0 0 3px rgba(251, 191, 36, 0.3); } 50% { box-shadow: 0 8px 35px rgba(251, 191, 36, 0.6), 0 0 0 4px rgba(251, 191, 36, 0.4); } }
    .helper-tooltip { animation: helper-bounce 2.5s ease-in-out infinite, helper-glow 2s ease-in-out infinite; }
    @keyframes lightbulb-pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.15); } }
    .lightbulb-glow { animation: lightbulb-pulse 1.5s ease-in-out infinite; }
    @keyframes confetti-fall { 0% { transform: translateY(-100vh) rotate(0deg); opacity: 1; } 100% { transform: translateY(100vh) rotate(720deg); opacity: 0; } }
    .confetti-piece { position: fixed; top: -10px; z-index: 100; animation: confetti-fall 3s ease-out forwards; pointer-events: none; }

    /* Demo Controls */
    .demo-controls {
      position: fixed; top: 0; left: 0; right: 0;
      background: #1F2937; color: white;
      z-index: 2000;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    }
    .demo-controls-toggle {
      display: flex; align-items: center; justify-content: space-between;
      padding: 8px 16px; cursor: pointer;
    }
    .demo-controls-body {
      padding: 0 16px 10px;
      display: none; max-height: 0; overflow: hidden;
    }
    .demo-controls-body.open { display: block; max-height: 500px; overflow-y: auto; }
    .demo-content-offset { padding-top: 36px; }
    .demo-controls .btn {
      font-size: 11px; padding: 5px 10px; margin: 2px;
      border-radius: 6px; border: 1px solid rgba(255,255,255,0.2);
      background: transparent; color: #D1D5DB; cursor: pointer;
      transition: all 0.15s;
    }
    .demo-controls .btn:hover { background: rgba(255,255,255,0.1); color: white; }
    .demo-controls .btn.active { background: var(--dripjobs-purple); border-color: var(--dripjobs-purple); color: white; }
    .demo-controls .btn.scheduling { background: #2563EB; border-color: #2563EB; color: white; }
    .demo-controls .btn.setup { background: #7C3AED; border-color: #7C3AED; color: white; }
  </style>
</head>
<body class="bg-gray-50 min-h-screen">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef, useCallback } = React;

    // ─── Icon Component ───
    const Icon = ({ name, size = 20, className = "" }) => {
      const ref = useRef(null);
      useEffect(() => {
        if (ref.current) {
          ref.current.innerHTML = '';
          const icon = lucide.createElement(lucide.icons[name]);
          if (icon) {
            icon.setAttribute('width', size);
            icon.setAttribute('height', size);
            if (className) className.split(' ').forEach(c => c && icon.classList.add(c));
            ref.current.appendChild(icon);
          }
        }
      }, [name, size, className]);
      return <span ref={ref} className="inline-flex items-center justify-center" />;
    };

    // ─── DripJobs Logo ───
    const DripJobsLogo = ({ size = 40 }) => (
      <svg width={size} height={size} viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M50 10L56 4H44L50 10Z" fill="#7C6AEE"/><path d="M50 90L44 96H56L50 90Z" fill="#7C6AEE"/>
        <path d="M10 50L4 44V56L10 50Z" fill="#7C6AEE"/><path d="M90 50L96 56V44L90 50Z" fill="#7C6AEE"/>
        <path d="M21.72 21.72L14.64 18.18L11.1 25.26L18.18 28.8L21.72 21.72Z" fill="#7C6AEE"/>
        <path d="M78.28 78.28L85.36 81.82L88.9 74.74L81.82 71.2L78.28 78.28Z" fill="#7C6AEE"/>
        <path d="M21.72 78.28L18.18 71.2L11.1 74.74L14.64 81.82L21.72 78.28Z" fill="#7C6AEE"/>
        <path d="M78.28 21.72L81.82 28.8L88.9 25.26L85.36 18.18L78.28 21.72Z" fill="#7C6AEE"/>
        <circle cx="50" cy="50" r="35" stroke="#7C6AEE" strokeWidth="12" fill="#7C6AEE"/>
        <ellipse cx="50" cy="48" rx="26" ry="22" fill="white"/>
        <path d="M30 58C30 58 28 70 20 72C28 70 36 66 38 62" fill="white"/>
        <circle cx="36" cy="48" r="5" fill="#7C6AEE"/><circle cx="50" cy="48" r="5" fill="#7C6AEE"/><circle cx="64" cy="48" r="5" fill="#7C6AEE"/>
      </svg>
    );

    // ─── Phone Formatter ───
    const formatPhone = (value) => {
      const digits = value.replace(/\D/g, '').slice(0, 10);
      if (digits.length === 0) return '';
      if (digits.length <= 3) return `(${digits}`;
      if (digits.length <= 6) return `(${digits.slice(0,3)}) ${digits.slice(3)}`;
      return `(${digits.slice(0,3)}) ${digits.slice(3,6)}-${digits.slice(6)}`;
    };

    // ─── Reusable Components ───
    const Toggle = ({ enabled, onChange, disabled = false }) => (
      <button type="button" onClick={() => !disabled && onChange(!enabled)}
        className={`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${enabled ? 'bg-purple-600' : 'bg-gray-300'} ${disabled ? 'opacity-50 cursor-not-allowed' : 'cursor-pointer'}`}>
        <span className={`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${enabled ? 'translate-x-6' : 'translate-x-1'}`} />
      </button>
    );

    const HelperTip = ({ children, className = "" }) => (
      <div className={`bg-gradient-to-br from-amber-50 to-yellow-100 border-2 border-amber-300 rounded-xl p-4 shadow-sm ${className}`}>
        <p className="text-sm text-amber-900 flex items-start gap-3 font-medium">
          <span className="flex-shrink-0 mt-0.5 lightbulb-glow"><Icon name="Lightbulb" size={20} className="text-yellow-500 fill-yellow-300" /></span>
          <span>{children}</span>
        </p>
      </div>
    );

    const FormInput = ({ label, required, error, ...props }) => (
      <div className="space-y-1">
        <label className="block text-sm font-medium text-gray-700">{label} {required && <span className="text-red-500">*</span>}</label>
        <input className={`w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-colors ${error ? 'border-red-500' : 'border-gray-300'}`} {...props} />
        {error && <p className="text-sm text-red-500">{error}</p>}
      </div>
    );

    const FormSelect = ({ label, required, options, error, ...props }) => (
      <div className="space-y-1">
        <label className="block text-sm font-medium text-gray-700">{label} {required && <span className="text-red-500">*</span>}</label>
        <select className={`w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-colors ${error ? 'border-red-500' : 'border-gray-300'}`} {...props}>
          {options.map((opt, i) => <option key={i} value={opt.value}>{opt.label}</option>)}
        </select>
        {error && <p className="text-sm text-red-500">{error}</p>}
      </div>
    );

    // ─── Progress Bar ───
    const ProgressBar = ({ currentStep, totalSteps, stepNames, onBack, isSchedulingPhase }) => (
      <div className="bg-white border-b border-gray-200 px-4 sm:px-6 py-4">
        <div className="max-w-3xl mx-auto">
          <div className="flex items-center justify-between mb-2">
            <div className="flex items-center gap-3">
              {currentStep > 1 && (
                <button onClick={onBack} className="p-1 rounded-lg hover:bg-gray-100 text-gray-500 hover:text-gray-700 transition-colors" title="Go back">
                  <Icon name="ChevronLeft" size={20} />
                </button>
              )}
              <span className="text-sm font-medium text-gray-700">
                {isSchedulingPhase ? (
                  <span className="flex items-center gap-2">
                    <span className="px-2 py-0.5 bg-blue-100 text-blue-700 rounded text-xs font-semibold">SCHEDULING</span>
                    {stepNames[currentStep - 1]}
                  </span>
                ) : (
                  <>Step {currentStep} of {totalSteps}: <span className="hidden sm:inline">{stepNames[currentStep - 1]}</span></>
                )}
              </span>
            </div>
            <span className="text-sm text-gray-500">{Math.round((currentStep / totalSteps) * 100)}%</span>
          </div>
          <div className="w-full bg-gray-200 rounded-full h-2">
            <div className={`h-2 rounded-full transition-all duration-500 ${isSchedulingPhase ? 'bg-blue-500' : 'bg-purple-600'}`}
              style={{ width: `${(currentStep / totalSteps) * 100}%` }} />
          </div>
        </div>
      </div>
    );

    // ─── Confetti Effect ───
    const Confetti = () => {
      const colors = ['#7C3AED', '#10B981', '#F59E0B', '#3B82F6', '#EF4444', '#EC4899'];
      return (
        <div>
          {Array.from({ length: 40 }).map((_, i) => (
            <div key={i} className="confetti-piece" style={{
              left: `${Math.random() * 100}%`, width: `${Math.random() * 8 + 4}px`, height: `${Math.random() * 8 + 4}px`,
              backgroundColor: colors[Math.floor(Math.random() * colors.length)],
              borderRadius: Math.random() > 0.5 ? '50%' : '0', animationDelay: `${Math.random() * 1.5}s`,
              animationDuration: `${Math.random() * 2 + 2}s`
            }} />
          ))}
        </div>
      );
    };

    // ═══════════════════════════════════════════════════
    // PHASE 1: WELCOME + SCHEDULING FLOW (Flow 2)
    // ═══════════════════════════════════════════════════

    // Welcome Screen — Payment Confirmation
    const WelcomeScreen = ({ onStart }) => {
      const pipelineColumns = [
        { name: 'Cold Leads', color: 'bg-blue-100', textColor: 'text-blue-700' },
        { name: 'Warm Leads', color: 'bg-yellow-100', textColor: 'text-yellow-700' },
        { name: 'Hot Leads', color: 'bg-orange-100', textColor: 'text-orange-700' },
        { name: 'Estimate Requested', color: 'bg-purple-100', textColor: 'text-purple-700' },
        { name: 'Estimate Scheduled', color: 'bg-indigo-100', textColor: 'text-indigo-700' },
        { name: 'In Draft', color: 'bg-gray-100', textColor: 'text-gray-700' },
        { name: 'Proposal(s) Sent', color: 'bg-green-100', textColor: 'text-green-700' },
        { name: 'Proposal(s) Rejected', color: 'bg-red-100', textColor: 'text-red-700' }
      ];

      return (
        <div className="min-h-screen bg-gray-50 relative">
          <header className="bg-white border-b border-gray-200">
            <div className="max-w-7xl mx-auto px-4 sm:px-6 py-4">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-3"><DripJobsLogo size={40} /><span className="text-xl font-bold text-gray-900">DripJobs</span></div>
                <div className="flex items-center gap-2">
                  <button className="px-3 py-1.5 bg-purple-600 text-white rounded-lg text-sm font-medium flex items-center gap-1 opacity-50 cursor-not-allowed"><Icon name="Plus" size={14} /> New Proposal</button>
                  <button className="px-3 py-1.5 border border-gray-300 text-gray-400 rounded-lg text-sm font-medium flex items-center gap-1 cursor-not-allowed"><Icon name="Calendar" size={14} /> New Appointment</button>
                </div>
              </div>
            </div>
          </header>

          {/* Dimmed Pipeline Background */}
          <div className="opacity-40 blur-[1px] pointer-events-none">
            <div className="px-4 sm:px-6 py-4">
              <h1 className="text-2xl font-bold text-gray-900">Sales Pipeline</h1>
              <div className="flex items-center gap-4 text-sm text-gray-600 mt-1"><span>Total Deals: <strong>0</strong></span><span>Total Value: <strong>$0.00</strong></span></div>
            </div>
            <div className="px-4 sm:px-6 py-3 bg-white border-y border-gray-200">
              <div className="flex flex-wrap items-center gap-2">
                <select className="px-3 py-1.5 border border-gray-300 rounded-lg text-sm bg-white" disabled><option>Default</option></select>
                <select className="px-3 py-1.5 border border-gray-300 rounded-lg text-sm bg-white" disabled><option>All Salespeople</option></select>
              </div>
            </div>
            <div className="px-4 sm:px-6 py-4 overflow-x-auto">
              <div className="flex gap-3 min-w-max">
                {pipelineColumns.map(col => (
                  <div key={col.name} className="w-48 flex-shrink-0">
                    <div className={`${col.color} rounded-t-lg px-3 py-2 flex items-center justify-between`}>
                      <span className={`font-medium text-sm ${col.textColor}`}>{col.name}</span><span className={`text-sm ${col.textColor}`}>0</span>
                    </div>
                    <div className="bg-gray-50 rounded-b-lg p-2 min-h-[250px]">
                      <div className="flex flex-col items-center justify-center h-32 text-gray-400"><Icon name="Inbox" size={24} /><p className="text-xs mt-1">No Deals</p></div>
                    </div>
                  </div>
                ))}
              </div>
            </div>
          </div>

          {/* Welcome Modal */}
          <div className="fixed inset-0 bg-black/30 backdrop-blur-sm flex items-center justify-center z-50 p-4">
            <div className="bg-white rounded-2xl shadow-2xl max-w-md w-full p-8 text-center fade-in pulse-glow">
              <div className="relative inline-block mb-6">
                <div className="w-24 h-24 bg-gradient-to-br from-green-400 to-green-600 rounded-full flex items-center justify-center float-animation shadow-lg">
                  <span className="text-5xl">&#x2705;</span>
                </div>
                <div className="absolute -top-2 -right-2 text-2xl sparkle">&#x2728;</div>
                <div className="absolute -bottom-1 -left-3 text-xl sparkle" style={{ animationDelay: '0.5s' }}>&#x2B50;</div>
              </div>

              <h1 className="text-3xl font-bold text-gray-900 mb-3">
                <span className="text-transparent bg-clip-text bg-gradient-to-r from-purple-600 to-purple-400">Welcome to DripJobs</span>
              </h1>
              <p className="text-lg text-gray-600 mb-6">Your account is ready. Let's get you set up to start winning more jobs.</p>

              {/* Value Props */}
              <div className="bg-gray-50 rounded-xl p-4 mb-6 text-left">
                <p className="text-sm font-semibold text-gray-700 mb-3">In the next few minutes, you'll:</p>
                {[
                  "Set up your company profile & branding",
                  "Add your products & services",
                  "Create your first proposal"
                ].map((item, i) => (
                  <div key={i} className="flex items-center gap-3 mb-2">
                    <div className="w-5 h-5 bg-green-500 rounded-full flex items-center justify-center flex-shrink-0">
                      <Icon name="Check" size={12} className="text-white" />
                    </div>
                    <span className="text-sm text-gray-600">{item}</span>
                  </div>
                ))}
              </div>

              <button onClick={onStart}
                className="w-full bg-gradient-to-r from-purple-600 to-purple-500 hover:from-purple-700 hover:to-purple-600 text-white px-8 py-4 rounded-xl font-semibold text-lg transition-all transform hover:scale-[1.02] active:scale-[0.98] shadow-lg hover:shadow-xl flex items-center justify-center gap-3">
                Let's Get Started <Icon name="ArrowRight" size={20} />
              </button>

              <div className="mt-5 flex items-center justify-center gap-2">
                <div className="w-8 h-1.5 bg-purple-600 rounded-full"></div>
                {[...Array(8)].map((_, i) => <div key={i} className="w-2 h-1.5 bg-gray-300 rounded-full"></div>)}
              </div>
              <p className="text-xs text-gray-400 mt-2">Takes about 5-10 minutes</p>
            </div>
          </div>
        </div>
      );
    };

    // Schedule Onboarding Screen — Video + CTA
    const ScheduleOnboardingScreen = ({ onSchedule, onSkip }) => (
      <div className="space-y-6 fade-in">
        <div className="text-center">
          <h1 className="text-3xl font-bold text-gray-900 mb-2">Get the Most Out of DripJobs</h1>
          <p className="text-base text-gray-600">Schedule a free 1-on-1 onboarding session with our team</p>
        </div>

        {/* Video Section */}
        <div className="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden max-w-2xl mx-auto">
          <div className="relative bg-gradient-to-br from-purple-700 to-purple-900 aspect-video flex items-center justify-center cursor-pointer group" onClick={onSchedule}>
            <div className="absolute inset-0 bg-black/20"></div>
            {/* Play Button */}
            <div className="relative z-10 w-20 h-20 bg-white/90 rounded-full flex items-center justify-center shadow-xl group-hover:scale-110 transition-transform">
              <div className="w-0 h-0 border-t-[14px] border-t-transparent border-l-[24px] border-l-purple-600 border-b-[14px] border-b-transparent ml-2"></div>
            </div>
            {/* Label */}
            <div className="absolute bottom-4 left-4 right-4 z-10">
              <div className="bg-black/60 backdrop-blur-sm rounded-lg px-4 py-3">
                <p className="text-white font-semibold">A Message from Tanner, CEO</p>
                <p className="text-white/80 text-sm">Why onboarding matters for your success (2 min)</p>
              </div>
            </div>
          </div>
        </div>

        {/* Value Points */}
        <div className="max-w-2xl mx-auto grid grid-cols-1 sm:grid-cols-3 gap-4">
          {[
            { icon: "Target", title: "Personalized Setup", desc: "Get your account configured for your specific business" },
            { icon: "TrendingUp", title: "Close 3x More Jobs", desc: "Users who complete onboarding see dramatic results" },
            { icon: "Headphones", title: "Expert Guidance", desc: "Live walkthrough with our onboarding specialist" }
          ].map((item, i) => (
            <div key={i} className="bg-white rounded-xl border border-gray-200 p-4 text-center">
              <div className="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center mx-auto mb-3">
                <Icon name={item.icon} size={20} className="text-purple-600" />
              </div>
              <h3 className="font-semibold text-gray-900 text-sm mb-1">{item.title}</h3>
              <p className="text-xs text-gray-500">{item.desc}</p>
            </div>
          ))}
        </div>

        {/* CTA */}
        <div className="max-w-md mx-auto text-center space-y-3">
          <button onClick={onSchedule}
            className="w-full bg-purple-600 hover:bg-purple-700 text-white px-8 py-4 rounded-xl font-semibold text-lg transition-all flex items-center justify-center gap-3 shadow-lg">
            <Icon name="Calendar" size={22} /> Schedule My Onboarding Session
          </button>

          <button onClick={onSkip} className="text-gray-500 hover:text-gray-700 text-sm underline transition-colors">
            I'll schedule later — take me to account setup
          </button>

          {/* Social Proof Nudge */}
          <div className="bg-blue-50 border border-blue-200 rounded-lg p-3 mt-4">
            <p className="text-sm text-blue-800 flex items-center justify-center gap-2">
              <Icon name="TrendingUp" size={16} className="text-blue-600" />
              <strong>Pro Tip:</strong> Users who schedule a demo close 3x more jobs in their first month
            </p>
          </div>
        </div>
      </div>
    );

    // Calendar Scheduling Screen
    const CalendarSchedulingScreen = ({ onConfirm, onBack }) => {
      const [selectedDate, setSelectedDate] = useState(null);
      const [selectedTime, setSelectedTime] = useState(null);

      // Generate next 5 available weekdays
      const getAvailableDates = () => {
        const dates = [];
        const today = new Date();
        let d = new Date(today);
        d.setDate(d.getDate() + 1);
        while (dates.length < 5) {
          if (d.getDay() !== 0 && d.getDay() !== 6) {
            dates.push(new Date(d));
          }
          d.setDate(d.getDate() + 1);
        }
        return dates;
      };

      const availableDates = getAvailableDates();
      const dayNames = ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];
      const monthNames = ['January','February','March','April','May','June','July','August','September','October','November','December'];

      const timeSlots = ['9:00 AM', '10:00 AM', '11:00 AM', '1:00 PM', '2:00 PM', '3:00 PM'];

      return (
        <div className="space-y-6 fade-in">
          <div className="text-center">
            <h1 className="text-3xl font-bold text-gray-900 mb-2">Pick a Date & Time</h1>
            <p className="text-base text-gray-600">Choose a time that works best for your onboarding session</p>
          </div>

          <div className="max-w-2xl mx-auto bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
            {/* Header */}
            <div className="bg-purple-600 text-white p-4 text-center">
              <h3 className="font-semibold text-lg">DripJobs Onboarding Session</h3>
              <p className="text-purple-200 text-sm">30-minute 1-on-1 video call</p>
            </div>

            <div className="p-6">
              <div className="flex flex-col md:flex-row gap-6">
                {/* Date Column */}
                <div className="flex-1">
                  <h4 className="text-sm font-semibold text-gray-700 mb-3 flex items-center gap-2">
                    <Icon name="Calendar" size={16} className="text-purple-600" /> Select a Date
                  </h4>
                  <div className="space-y-2">
                    {availableDates.map((date, i) => (
                      <div key={i} onClick={() => setSelectedDate(i)}
                        className={`border-2 rounded-lg p-3 cursor-pointer transition-all flex items-center justify-between ${
                          selectedDate === i ? 'border-purple-600 bg-purple-50' : 'border-gray-200 hover:border-purple-300'
                        }`}>
                        <div>
                          <p className="font-semibold text-gray-900 text-sm">{dayNames[date.getDay()]}</p>
                          <p className="text-gray-500 text-xs">{monthNames[date.getMonth()]} {date.getDate()}, {date.getFullYear()}</p>
                        </div>
                        {selectedDate === i && <Icon name="CheckCircle" size={20} className="text-purple-600" />}
                      </div>
                    ))}
                  </div>
                </div>

                {/* Time Column */}
                <div className="flex-1">
                  <h4 className="text-sm font-semibold text-gray-700 mb-3 flex items-center gap-2">
                    <Icon name="Clock" size={16} className="text-purple-600" /> Select a Time
                  </h4>
                  <div className="grid grid-cols-2 gap-2">
                    {timeSlots.map((time, i) => (
                      <div key={i} onClick={() => selectedDate !== null && setSelectedTime(i)}
                        className={`border-2 rounded-lg p-3 text-center cursor-pointer transition-all text-sm font-medium ${
                          selectedDate === null ? 'border-gray-200 text-gray-300 cursor-not-allowed' :
                          selectedTime === i ? 'border-purple-600 bg-purple-600 text-white' : 'border-gray-200 text-gray-700 hover:border-purple-300'
                        }`}>
                        {time}
                      </div>
                    ))}
                  </div>
                  {selectedDate === null && (
                    <p className="text-xs text-gray-400 mt-3 text-center">Select a date first to see available times</p>
                  )}
                </div>
              </div>

              {/* Timezone */}
              <div className="text-center text-xs text-gray-400 mt-4 pt-4 border-t border-gray-100 flex items-center justify-center gap-1">
                <Icon name="Globe" size={12} /> Times shown in Eastern Standard Time (EST)
              </div>
            </div>
          </div>

          {/* Actions */}
          <div className="max-w-2xl mx-auto flex justify-between items-center">
            <button onClick={onBack} className="bg-white border-2 border-gray-300 hover:border-gray-400 text-gray-700 px-6 py-3 rounded-lg font-medium transition-colors">Back</button>
            <button onClick={() => {
              if (selectedDate !== null && selectedTime !== null) {
                onConfirm({
                  date: availableDates[selectedDate],
                  time: timeSlots[selectedTime],
                  dateStr: `${dayNames[availableDates[selectedDate].getDay()]}, ${monthNames[availableDates[selectedDate].getMonth()]} ${availableDates[selectedDate].getDate()}`,
                  timeStr: timeSlots[selectedTime]
                });
              }
            }}
              disabled={selectedDate === null || selectedTime === null}
              className="bg-purple-600 hover:bg-purple-700 text-white px-8 py-3 rounded-lg font-semibold transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2">
              Confirm Booking <Icon name="ArrowRight" size={18} />
            </button>
          </div>
        </div>
      );
    };

    // Booking Confirmation Screen
    const BookingConfirmationScreen = ({ booking, onContinue }) => {
      const [showConfetti, setShowConfetti] = useState(true);
      useEffect(() => { const t = setTimeout(() => setShowConfetti(false), 3500); return () => clearTimeout(t); }, []);

      return (
        <div className="max-w-md mx-auto text-center py-8 fade-in">
          {showConfetti && <Confetti />}
          <div className="w-20 h-20 bg-green-500 rounded-full flex items-center justify-center mx-auto mb-6 shadow-lg" style={{ animation: 'scaleIn 0.5s ease-out' }}>
            <Icon name="Check" size={40} className="text-white" />
          </div>

          <h1 className="text-3xl font-bold text-gray-900 mb-3">You're Booked!</h1>
          <p className="text-lg text-gray-600 mb-6">Your onboarding session has been scheduled. We'll send you a confirmation email with the details.</p>

          {/* Booking Details */}
          <div className="bg-gray-50 rounded-xl p-6 mb-6 text-left">
            <h3 className="text-sm font-semibold text-gray-700 text-center mb-4">Session Details</h3>
            <div className="space-y-3">
              <div className="flex items-center gap-3">
                <Icon name="Calendar" size={18} className="text-purple-600" />
                <span className="text-gray-700">{booking?.dateStr || 'Monday, February 12'}</span>
              </div>
              <div className="flex items-center gap-3">
                <Icon name="Clock" size={18} className="text-purple-600" />
                <span className="text-gray-700">{booking?.timeStr || '10:00 AM'} EST (30 minutes)</span>
              </div>
              <div className="flex items-center gap-3">
                <Icon name="Video" size={18} className="text-purple-600" />
                <span className="text-gray-700">Video call (link will be emailed)</span>
              </div>
              <div className="flex items-center gap-3">
                <Icon name="User" size={18} className="text-purple-600" />
                <span className="text-gray-700">DripJobs Onboarding Specialist</span>
              </div>
            </div>
          </div>

          <p className="text-sm text-gray-500 mb-6">In the meantime, let's set up your account so you're ready to go!</p>

          <button onClick={onContinue}
            className="w-full bg-gradient-to-r from-purple-600 to-purple-500 hover:from-purple-700 hover:to-purple-600 text-white px-8 py-4 rounded-xl font-semibold text-lg transition-all flex items-center justify-center gap-3 shadow-lg">
            <Icon name="Settings" size={22} /> Continue to Account Setup <Icon name="ArrowRight" size={18} />
          </button>
        </div>
      );
    };

    // Skip Scheduling Screen
    const SkipSchedulingScreen = ({ onContinue, onGoBack }) => (
      <div className="max-w-md mx-auto text-center py-8 fade-in">
        <div className="w-20 h-20 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-6">
          <Icon name="Rocket" size={40} className="text-purple-600" />
        </div>

        <h1 className="text-3xl font-bold text-gray-900 mb-3">No Problem!</h1>
        <p className="text-lg text-gray-600 mb-6">You can always schedule an onboarding session later. Let's get your account set up now.</p>

        {/* Nudge */}
        <div className="bg-amber-50 border border-amber-200 rounded-xl p-4 mb-6 text-left">
          <p className="text-sm text-amber-800 flex items-start gap-2">
            <Icon name="Info" size={16} className="text-amber-600 flex-shrink-0 mt-0.5" />
            <span><strong>Did you know?</strong> You can schedule your onboarding session anytime from the Settings menu or by contacting our support team.</span>
          </p>
        </div>

        <div className="space-y-3">
          <button onClick={onContinue}
            className="w-full bg-gradient-to-r from-purple-600 to-purple-500 hover:from-purple-700 hover:to-purple-600 text-white px-8 py-4 rounded-xl font-semibold text-lg transition-all flex items-center justify-center gap-3 shadow-lg">
            <Icon name="Settings" size={22} /> Continue to Account Setup <Icon name="ArrowRight" size={18} />
          </button>
          <button onClick={onGoBack} className="text-purple-600 hover:text-purple-800 text-sm underline transition-colors">
            Actually, I'd like to schedule a session
          </button>
        </div>
      </div>
    );

    // ═══════════════════════════════════════════════════
    // PHASE 2: ACCOUNT SETUP WIZARD (Flow 1)
    // ═══════════════════════════════════════════════════

    // Step 1: Company Information
    const Step1CompanyInfo = ({ data, setData, onNext, onBack, errors, setErrors }) => {
      const [chargebeeLoaded, setChargebeeLoaded] = useState(false);
      const [loading, setLoading] = useState(true);

      useEffect(() => {
        // Simulate auto-populating from ChargeBee billing data
        const timer = setTimeout(() => {
          setData(prev => ({
            ...prev,
            companyName: prev.companyName || "Premier Painting Co.",
            shortName: prev.shortName || "Premier",
            phone: prev.phone || "(404) 555-1234",
            streetAddress: prev.streetAddress || "123 Main Street",
            city: prev.city || "Atlanta",
            state: prev.state || "GA",
            zipCode: prev.zipCode || "30301"
          }));
          setChargebeeLoaded(true);
          setLoading(false);
        }, 800);
        return () => clearTimeout(timer);
      }, []);

      const validate = () => {
        const e = {};
        if (!data.companyName) e.companyName = "Required";
        if (!data.shortName) e.shortName = "Required";
        if (!data.streetAddress) e.streetAddress = "Required";
        if (!data.city) e.city = "Required";
        if (!data.state) e.state = "Required";
        if (!data.zipCode) e.zipCode = "Required";
        if (!data.phone) e.phone = "Required";
        setErrors(e);
        return Object.keys(e).length === 0;
      };

      return (
        <div className="space-y-6">
          <div>
            <h1 className="text-3xl font-bold text-gray-900">Company Information</h1>
            <p className="mt-2 text-base text-gray-600">Tell us about your business so we can customize your experience.</p>
          </div>

          {loading && (
            <div className="bg-blue-50 border border-blue-200 rounded-xl p-4 flex items-center gap-3 fade-in">
              <div className="animate-spin w-5 h-5 border-2 border-blue-600 border-t-transparent rounded-full flex-shrink-0"></div>
              <p className="text-sm text-blue-800">Pulling your info from ChargeBee billing...</p>
            </div>
          )}

          {chargebeeLoaded && (
            <div className="bg-green-50 border border-green-200 rounded-xl p-4 flex items-start gap-3 fade-in">
              <div className="w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center flex-shrink-0">
                <Icon name="CheckCircle" size={18} className="text-green-600" />
              </div>
              <div>
                <p className="text-sm font-medium text-green-800">Auto-populated from ChargeBee</p>
                <p className="text-xs text-green-600 mt-0.5">We pulled your company details from your billing account. Review and update anything that needs changing.</p>
              </div>
            </div>
          )}

          <HelperTip>Fill in your company details below. Required fields are marked with a red asterisk (<span className="text-red-500">*</span>). This info will appear on your proposals and invoices.</HelperTip>

          <div className="bg-white rounded-xl shadow-sm border border-gray-200 p-6 space-y-6">
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              <FormInput label="Company Name" required value={data.companyName} onChange={e => setData({...data, companyName: e.target.value})} placeholder="Enter company name" error={errors.companyName} />
              <FormInput label="Short Name" required value={data.shortName} onChange={e => setData({...data, shortName: e.target.value})} placeholder="Enter short name" error={errors.shortName} />
            </div>
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              <FormSelect label="Business Type" required value={data.businessType} onChange={e => setData({...data, businessType: e.target.value})}
                options={[{value:"Painting",label:"Painting"},{value:"Other Contracting",label:"Other Contracting"},{value:"General Contractor",label:"General Contractor"}]} />
              <FormSelect label="Time Zone" required value={data.timeZone} onChange={e => setData({...data, timeZone: e.target.value})}
                options={[{value:"EST",label:"Eastern Standard Time"},{value:"CST",label:"Central Standard Time"},{value:"MST",label:"Mountain Standard Time"},{value:"PST",label:"Pacific Standard Time"}]} />
            </div>
            <div className="border-t border-gray-200 pt-6">
              <h3 className="text-lg font-semibold text-gray-900 mb-4">Physical Address</h3>
              <div className="space-y-4">
                <FormInput label="Street Address" required value={data.streetAddress} onChange={e => setData({...data, streetAddress: e.target.value})} placeholder="Enter street address" error={errors.streetAddress} />
                <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                  <FormInput label="City" required value={data.city} onChange={e => setData({...data, city: e.target.value})} placeholder="City" error={errors.city} />
                  <FormInput label="State" required value={data.state} onChange={e => setData({...data, state: e.target.value})} placeholder="State" error={errors.state} />
                  <FormInput label="Zip Code" required value={data.zipCode} onChange={e => setData({...data, zipCode: e.target.value})} placeholder="Zip" error={errors.zipCode} />
                </div>
              </div>
            </div>
            <div className="border-t border-gray-200 pt-6">
              <h3 className="text-lg font-semibold text-gray-900 mb-4">Contact Info</h3>
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <FormInput label="Phone" required value={data.phone} onChange={e => setData({...data, phone: formatPhone(e.target.value)})} placeholder="(555) 555-5555" error={errors.phone} />
                <FormInput label="License Number" value={data.licenseNumber} onChange={e => setData({...data, licenseNumber: e.target.value})} placeholder="Optional" />
              </div>
            </div>
          </div>

          <div className="flex justify-between">
            <button onClick={onBack} className="bg-white border-2 border-gray-300 hover:border-gray-400 text-gray-700 px-6 py-3 rounded-lg font-medium transition-colors">Back</button>
            <button onClick={() => { if (validate()) onNext(); }} className="bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg font-medium transition-colors">Continue</button>
          </div>
        </div>
      );
    };

    // Step 2: Brand Setup
    const Step2BrandSetup = ({ data, setData, onNext, onBack }) => {
      const [brandFinderUsed, setBrandFinderUsed] = useState(data.brandFinderUsed || false);
      const [loading, setLoading] = useState(false);
      const [searchTerm, setSearchTerm] = useState(data.companyName || "");

      const handleBrandFinder = () => {
        setLoading(true);
        setTimeout(() => { setLoading(false); setBrandFinderUsed(true); setData({...data, brandFinderUsed: true, logoFile: "company-logo.png", accentColor: "#7C3AED"}); }, 1000);
      };

      return (
        <div className="space-y-6">
          <div><h1 className="text-3xl font-bold text-gray-900">Set Up Your Brand</h1><p className="mt-2 text-base text-gray-600">Customize how your company appears to customers.</p></div>
          <HelperTip>Try our <strong>Brand Finder</strong> to automatically pull in your logo and brand colors from your website. Or skip ahead and upload manually.</HelperTip>

          {!brandFinderUsed && (
            <div className="bg-purple-50 border border-purple-200 rounded-xl p-6">
              <div className="flex items-start gap-4">
                <div className="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center flex-shrink-0"><Icon name="Palette" size={24} className="text-purple-600" /></div>
                <div className="flex-1">
                  <h3 className="text-lg font-semibold text-gray-900">Brand Finder</h3>
                  <p className="text-gray-600 mt-1">Enter your company website and we'll pull in your logo and brand data.</p>
                  <div className="mt-4 flex flex-col sm:flex-row gap-3">
                    <input type="text" value={searchTerm} onChange={e => setSearchTerm(e.target.value)} placeholder="Enter company name or URL" className="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" />
                    <button onClick={handleBrandFinder} disabled={loading} className="bg-purple-600 hover:bg-purple-700 text-white px-6 py-2 rounded-lg font-medium transition-colors disabled:opacity-50">{loading ? "Searching..." : "Go"}</button>
                  </div>
                </div>
              </div>
            </div>
          )}

          {brandFinderUsed && (
            <div className="bg-green-50 border border-green-200 rounded-xl p-4 flex items-center gap-3">
              <div className="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center checkmark-animate"><Icon name="Check" size={18} className="text-white" /></div>
              <p className="text-green-800 font-medium">Found your company! We've populated your logo and brand colors.</p>
            </div>
          )}

          <div className="bg-white rounded-xl shadow-sm border border-gray-200 p-6 space-y-6">
            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div className="space-y-1">
                <label className="block text-sm font-medium text-gray-700">Company Logo</label>
                <div className="flex items-center gap-4">
                  <div className="w-20 h-20 bg-gray-100 rounded-lg border-2 border-dashed border-gray-300 flex items-center justify-center">
                    {data.logoFile ? (<div className="text-center"><Icon name="Image" size={24} className="text-purple-600 mx-auto" /><span className="text-xs text-gray-500 mt-1 block truncate w-16">{data.logoFile}</span></div>) : (<Icon name="Upload" size={24} className="text-gray-400" />)}
                  </div>
                  <button className="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors">Choose file</button>
                </div>
              </div>
              <div className="space-y-1">
                <label className="block text-sm font-medium text-gray-700">Portal Accent Color</label>
                <div className="flex items-center gap-3">
                  <input type="color" value={data.accentColor || "#7C3AED"} onChange={e => setData({...data, accentColor: e.target.value})} className="w-12 h-12 rounded-lg border border-gray-300 cursor-pointer" />
                  <input type="text" value={data.accentColor || "#7C3AED"} onChange={e => setData({...data, accentColor: e.target.value})} className="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" />
                </div>
              </div>
            </div>
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              <FormInput label="Website URL" value={data.websiteUrl || ""} onChange={e => setData({...data, websiteUrl: e.target.value})} placeholder="https://www.example.com" />
              <FormInput label="Review URL" value={data.reviewUrl || ""} onChange={e => setData({...data, reviewUrl: e.target.value})} placeholder="https://www.google.com/review/..." />
            </div>
            <div className="border-t border-gray-200 pt-6">
              <h3 className="text-lg font-semibold text-gray-900 mb-4">Social Profiles</h3>
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                {[{icon:"Facebook",color:"text-blue-600",label:"Facebook",key:"facebookUrl",placeholder:"https://facebook.com/..."},{icon:"Instagram",color:"text-pink-600",label:"Instagram",key:"instagramUrl",placeholder:"https://instagram.com/..."},{icon:"Linkedin",color:"text-blue-700",label:"LinkedIn",key:"linkedinUrl",placeholder:"https://linkedin.com/..."}].map(s => (
                  <div key={s.key} className="space-y-1">
                    <label className="block text-sm font-medium text-gray-700 flex items-center gap-2"><Icon name={s.icon} size={16} className={s.color} /> {s.label} URL</label>
                    <input type="text" value={data[s.key] || ""} onChange={e => setData({...data, [s.key]: e.target.value})} placeholder={s.placeholder} className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" />
                  </div>
                ))}
                <div className="space-y-1">
                  <label className="block text-sm font-medium text-gray-700 flex items-center gap-2">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" className="text-gray-900"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
                    X URL
                  </label>
                  <input type="text" value={data.xUrl || ""} onChange={e => setData({...data, xUrl: e.target.value})} placeholder="https://x.com/..." className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" />
                </div>
              </div>
            </div>
          </div>

          <div className="flex justify-between items-center">
            <button onClick={onBack} className="bg-white border-2 border-gray-300 hover:border-gray-400 text-gray-700 px-6 py-3 rounded-lg font-medium transition-colors">Back</button>
            {!brandFinderUsed && <button onClick={() => setBrandFinderUsed(true)} className="text-gray-500 hover:text-gray-700 underline text-sm">Skip Brand Finder</button>}
            <button onClick={onNext} className="bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg font-medium transition-colors">Continue</button>
          </div>
        </div>
      );
    };

    // Step 3: Products/Services
    const Step3Products = ({ data, setData, onNext, onBack }) => {
      const [showModal, setShowModal] = useState(false);
      const [editingIndex, setEditingIndex] = useState(null);
      const [modalData, setModalData] = useState({ type: "Service", name: "", price: "", description: "", active: true, descriptionOnly: false });

      const defaultProducts = [
        { name: "Exterior Paint", price: 3500, checked: true, type: "Service", descriptionOnly: false },
        { name: "Interior Paint", price: 2500, checked: true, type: "Service", descriptionOnly: false },
        { name: "Trim Work", price: 800, checked: true, type: "Service", descriptionOnly: false },
        { name: "Ceiling Paint", price: 1200, checked: false, type: "Service", descriptionOnly: false },
        { name: "Cabinet Refinishing", price: 4000, checked: false, type: "Service", descriptionOnly: false },
        { name: "Pressure Washing", price: 600, checked: false, type: "Service", descriptionOnly: false }
      ];

      const products = data.products || defaultProducts;
      const checkedCount = products.filter(p => p.checked).length;

      const handleToggleProduct = (index) => { const np = [...products]; np[index].checked = !np[index].checked; setData({...data, products: np}); };
      const handleEdit = (index) => { setEditingIndex(index); setModalData({...products[index]}); setShowModal(true); };
      const handleAddNew = () => { setEditingIndex(null); setModalData({ type: "Service", name: "", price: "", description: "", active: true, descriptionOnly: false }); setShowModal(true); };
      const handleSave = () => {
        const np = [...products];
        if (editingIndex !== null) np[editingIndex] = {...modalData, price: parseFloat(modalData.price) || 0, checked: true};
        else np.push({...modalData, price: parseFloat(modalData.price) || 0, checked: true});
        setData({...data, products: np}); setShowModal(false);
      };

      return (
        <div className="space-y-6">
          <div><h1 className="text-3xl font-bold text-gray-900">Products & Services</h1><p className="mt-2 text-base text-gray-600">Select which products/services you offer. These will be used in your proposals.</p></div>
          <HelperTip>We've pre-populated common painting services. Click to select, <strong>Edit</strong> to customize, or <strong>+ Add Another</strong> to create new ones.</HelperTip>

          <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
            {products.map((product, index) => (
              <div key={index} className={`bg-white rounded-xl shadow-sm border-2 p-4 transition-all cursor-pointer ${product.checked ? 'border-purple-500 bg-purple-50' : 'border-gray-200 hover:border-gray-300'}`}
                onClick={() => handleToggleProduct(index)}>
                <div className="flex items-start justify-between">
                  <div className="flex items-center gap-3">
                    <div className={`w-6 h-6 rounded-md border-2 flex items-center justify-center ${product.checked ? 'bg-purple-600 border-purple-600' : 'border-gray-300'}`}>
                      {product.checked && <Icon name="Check" size={14} className="text-white" />}
                    </div>
                    <div>
                      <h3 className="font-semibold text-gray-900">{product.name}</h3>
                      {product.descriptionOnly ? <p className="text-sm text-gray-500 italic">Description Only</p> : <p className="text-lg font-bold text-purple-600">${product.price.toLocaleString()}</p>}
                    </div>
                  </div>
                  <button onClick={e => { e.stopPropagation(); handleEdit(index); }} className="text-purple-600 hover:text-purple-800 text-sm font-medium">Edit</button>
                </div>
              </div>
            ))}
          </div>

          <button onClick={handleAddNew} className="flex items-center gap-2 text-purple-600 hover:text-purple-800 font-medium"><Icon name="Plus" size={20} /> Add Another Product/Service</button>

          {showModal && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
              <div className="bg-white rounded-xl shadow-xl max-w-md w-full p-6 space-y-4 fade-in">
                <h2 className="text-xl font-semibold text-gray-900">{editingIndex !== null ? 'Edit' : 'Add'} Product/Service</h2>
                <FormSelect label="Type" value={modalData.type} onChange={e => setModalData({...modalData, type: e.target.value})} options={[{value:"Service",label:"Service"},{value:"Product",label:"Product"}]} />
                <FormInput label="Name" required value={modalData.name} onChange={e => setModalData({...modalData, name: e.target.value})} placeholder="Enter name" />
                <div className="space-y-1">
                  <label className="block text-sm font-medium text-gray-700">Price</label>
                  <div className="relative"><span className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500">$</span>
                    <input type="number" value={modalData.price} onChange={e => setModalData({...modalData, price: e.target.value})} placeholder="0.00" className="w-full pl-8 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500" />
                  </div>
                </div>
                <div className="flex items-center justify-between"><div><span className="text-sm font-medium text-gray-700">Description Only</span></div><Toggle enabled={modalData.descriptionOnly} onChange={val => setModalData({...modalData, descriptionOnly: val})} /></div>
                <div className="flex justify-end gap-3 pt-4 border-t">
                  <button onClick={() => setShowModal(false)} className="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">Cancel</button>
                  <button onClick={handleSave} disabled={!modalData.name} className="px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-medium disabled:opacity-50">Save</button>
                </div>
              </div>
            </div>
          )}

          <div className="flex justify-between">
            <button onClick={onBack} className="bg-white border-2 border-gray-300 hover:border-gray-400 text-gray-700 px-6 py-3 rounded-lg font-medium transition-colors">Back</button>
            <button onClick={onNext} disabled={checkedCount === 0} className="bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg font-medium transition-colors disabled:opacity-50">Continue</button>
          </div>
        </div>
      );
    };

    // Step 4: Platform Add-Ons (Skippable)
    const Step4AddOns = ({ data, setData, onNext, onBack }) => {
      const [confirmModal, setConfirmModal] = useState(null);
      const addOns = data.addOns || { productionRates: false, jobiAI: false, jobCosting: false, textMessaging: false };

      const addOnCards = [
        { key: "textMessaging", icon: "MessageSquare", title: "Text Messaging", price: "$29/m", description: "Send appointment reminders and follow-ups directly via SMS.", disabled: true, disabledReason: "Complete setup first" },
        { key: "productionRates", icon: "BarChart3", title: "Production Rates", price: "$99/m", description: "Accurately estimate material cost & materials for painting projects.", disabled: false },
        { key: "jobiAI", icon: "Bot", title: "Jobi AI", price: "$39/m", description: "AI-powered deal analysis, customer communications, and data-driven insights.", disabled: false },
        { key: "jobCosting", icon: "DollarSign", title: "Job Costing", price: "$49/m", description: "Monitor labor and project expenses, calculate job profitability.", disabled: false }
      ];

      return (
        <div className="space-y-6">
          <div><h1 className="text-3xl font-bold text-gray-900">Platform Add-Ons</h1><p className="mt-2 text-base text-gray-600">Optional add-ons to enhance your experience. You can enable these later from Settings.</p></div>
          <HelperTip>These are <strong>optional</strong>. Click <strong>Add</strong> on any you'd like, or skip this step entirely. You can always add them later.</HelperTip>

          <div className="bg-blue-50 border border-blue-200 rounded-xl p-5">
            <div className="flex items-start gap-4">
              <div className="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0"><Icon name="MessageSquare" size={20} className="text-blue-600" /></div>
              <div><h3 className="font-semibold text-gray-900">Text Messaging</h3><p className="text-sm text-gray-600 mt-1">Our most powerful add-on for customer communication. We recommend enabling it after setup is complete.</p></div>
            </div>
          </div>

          <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
            {addOnCards.map(card => (
              <div key={card.key} className={`bg-white rounded-xl shadow-sm border-2 p-5 transition-all flex flex-col ${card.disabled ? 'border-gray-200 opacity-75' : addOns[card.key] ? 'border-purple-500' : 'border-gray-200'}`}>
                <div className="flex items-center justify-between mb-3">
                  <div className={`w-10 h-10 rounded-lg flex items-center justify-center ${card.disabled ? 'bg-gray-100' : 'bg-purple-100'}`}>
                    <Icon name={card.icon} size={20} className={card.disabled ? 'text-gray-400' : 'text-purple-600'} />
                  </div>
                  <span className="text-base font-bold text-gray-900">{card.price}</span>
                </div>
                <h3 className="text-base font-semibold text-gray-900 mb-2">{card.title}</h3>
                <p className="text-sm text-gray-600 mb-4 flex-grow">{card.description}</p>
                <button onClick={() => { if (!card.disabled) { if (addOns[card.key]) { setData({...data, addOns: {...addOns, [card.key]: false}}); } else { setConfirmModal(card); } } }}
                  disabled={card.disabled}
                  className={`w-full py-2 rounded-lg font-medium transition-colors ${card.disabled ? 'bg-gray-200 text-gray-400 cursor-not-allowed' : addOns[card.key] ? 'bg-green-500 text-white hover:bg-green-600' : 'bg-purple-600 text-white hover:bg-purple-700'}`}>
                  {card.disabled ? <span className="text-xs">{card.disabledReason}</span> : addOns[card.key] ? <span className="flex items-center justify-center gap-2"><Icon name="Check" size={16} /> Added</span> : 'Add'}
                </button>
              </div>
            ))}
          </div>

          {/* Add-On Confirmation Modal */}
          {confirmModal && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
              <div className="bg-white rounded-xl shadow-xl max-w-md w-full fade-in">
                <div className="flex items-center justify-between p-5 border-b border-gray-200">
                  <h2 className="text-lg font-bold text-gray-900">Add {confirmModal.title}?</h2>
                  <button onClick={() => setConfirmModal(null)} className="text-gray-400 hover:text-gray-600"><Icon name="X" size={20} /></button>
                </div>
                <div className="p-5 space-y-4">
                  <div className="flex items-center gap-4">
                    <div className="w-12 h-12 bg-purple-100 rounded-xl flex items-center justify-center flex-shrink-0">
                      <Icon name={confirmModal.icon} size={24} className="text-purple-600" />
                    </div>
                    <div>
                      <h3 className="font-semibold text-gray-900">{confirmModal.title}</h3>
                      <span className="text-purple-600 font-bold">{confirmModal.price}</span>
                    </div>
                  </div>
                  <p className="text-gray-600 text-sm">{confirmModal.description}</p>
                  {confirmModal.key === 'productionRates' && (
                    <div className="bg-purple-50 rounded-lg p-3 space-y-2">
                      <p className="text-sm text-purple-800 font-medium">Includes:</p>
                      <ul className="text-sm text-purple-700 space-y-1">
                        <li className="flex items-center gap-2"><Icon name="Check" size={14} className="text-purple-500" /> Accurate material & labor estimates</li>
                        <li className="flex items-center gap-2"><Icon name="Check" size={14} className="text-purple-500" /> Pre-built painting rate tables</li>
                        <li className="flex items-center gap-2"><Icon name="Check" size={14} className="text-purple-500" /> Custom rate configuration</li>
                      </ul>
                    </div>
                  )}
                  {confirmModal.key === 'jobiAI' && (
                    <div className="bg-purple-50 rounded-lg p-3 space-y-2">
                      <p className="text-sm text-purple-800 font-medium">Includes:</p>
                      <ul className="text-sm text-purple-700 space-y-1">
                        <li className="flex items-center gap-2"><Icon name="Check" size={14} className="text-purple-500" /> AI-powered deal analysis</li>
                        <li className="flex items-center gap-2"><Icon name="Check" size={14} className="text-purple-500" /> Smart customer communications</li>
                        <li className="flex items-center gap-2"><Icon name="Check" size={14} className="text-purple-500" /> Data-driven business insights</li>
                      </ul>
                    </div>
                  )}
                  {confirmModal.key === 'jobCosting' && (
                    <div className="bg-purple-50 rounded-lg p-3 space-y-2">
                      <p className="text-sm text-purple-800 font-medium">Includes:</p>
                      <ul className="text-sm text-purple-700 space-y-1">
                        <li className="flex items-center gap-2"><Icon name="Check" size={14} className="text-purple-500" /> Labor & expense tracking</li>
                        <li className="flex items-center gap-2"><Icon name="Check" size={14} className="text-purple-500" /> Job profitability calculator</li>
                        <li className="flex items-center gap-2"><Icon name="Check" size={14} className="text-purple-500" /> Project budget monitoring</li>
                      </ul>
                    </div>
                  )}
                  <div className="bg-amber-50 border border-amber-200 rounded-lg p-3 flex items-start gap-2">
                    <Icon name="Info" size={16} className="text-amber-600 flex-shrink-0 mt-0.5" />
                    <p className="text-xs text-amber-800">This add-on will be added to your monthly subscription at <strong>{confirmModal.price}</strong>. You can remove it anytime from Settings.</p>
                  </div>
                </div>
                <div className="flex justify-end gap-3 p-5 border-t border-gray-200">
                  <button onClick={() => { setData({...data, addOns: {...addOns, [confirmModal.key]: true}}); setConfirmModal(null); }}
                    className="px-6 py-2.5 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-medium transition-colors">
                    Add {confirmModal.title}
                  </button>
                  <button onClick={() => setConfirmModal(null)}
                    className="px-6 py-2.5 border border-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-50 transition-colors">
                    Cancel
                  </button>
                </div>
              </div>
            </div>
          )}

          <div className="flex justify-between items-center">
            <button onClick={onBack} className="bg-white border-2 border-gray-300 hover:border-gray-400 text-gray-700 px-6 py-3 rounded-lg font-medium transition-colors">Back</button>
            <button onClick={onNext} className="text-gray-500 hover:text-gray-700 underline text-sm">Skip Add-Ons</button>
            <button onClick={onNext} className="bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg font-medium transition-colors">Continue</button>
          </div>
        </div>
      );
    };

    // Step 5: Team Members (Skippable)
    const Step5TeamMembers = ({ data, setData, onNext, onBack }) => {
      const [selectedOption, setSelectedOption] = useState(null);
      const [errors, setErrors] = useState({});
      const teamMember = data.teamMember || { email: "", firstName: "", lastName: "", phone: "", defaultCalendar: "Week",
        roles: { administrator: false, branchAdmin: false, salesperson: true, projectManager: false, jobCosting: false, chat: false },
        showAllJobs: false, emailNotification: true, textNotification: true
      };

      const updateTeamMember = (updates) => setData({...data, teamMember: {...teamMember, ...updates}});

      const validate = () => {
        const e = {};
        if (!teamMember.email) e.email = "Required";
        if (!teamMember.firstName) e.firstName = "Required";
        if (!teamMember.lastName) e.lastName = "Required";
        setErrors(e);
        return Object.keys(e).length === 0;
      };

      return (
        <div className="space-y-6">
          <div><h1 className="text-3xl font-bold text-gray-900">Team Members</h1><p className="mt-2 text-base text-gray-600">Invite team members now or add them later from Settings.</p></div>
          <HelperTip>If you work with a team, add them here. Working solo? Just click <strong>Skip for Now</strong> to continue.</HelperTip>

          {selectedOption === null && (
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div onClick={() => setSelectedOption('add')} className="bg-white rounded-xl shadow-sm border-2 border-gray-200 hover:border-purple-500 p-6 cursor-pointer transition-all">
                <div className="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center mb-4"><Icon name="Users" size={24} className="text-purple-600" /></div>
                <h3 className="text-lg font-semibold text-gray-900 mb-2">Add a Team Member Now</h3>
                <p className="text-gray-600 mb-4">Invite salespeople, project managers, or other team members.</p>
                <button className="w-full py-2 bg-purple-600 text-white rounded-lg font-medium hover:bg-purple-700">Select</button>
              </div>
              <div onClick={() => { setSelectedOption('skip'); onNext(); }} className="bg-white rounded-xl shadow-sm border-2 border-gray-200 hover:border-purple-500 p-6 cursor-pointer transition-all">
                <div className="w-12 h-12 bg-gray-100 rounded-lg flex items-center justify-center mb-4"><Icon name="FastForward" size={24} className="text-gray-600" /></div>
                <h3 className="text-lg font-semibold text-gray-900 mb-2">Skip For Now</h3>
                <p className="text-gray-600 mb-4">I'll add team members later from settings.</p>
                <button className="w-full py-2 bg-white border-2 border-gray-300 text-gray-700 rounded-lg font-medium hover:border-gray-400">Skip</button>
              </div>
            </div>
          )}

          {selectedOption === 'add' && (
            <div className="bg-white rounded-xl shadow-sm border border-gray-200 p-6 space-y-6">
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <FormInput label="Email" required type="email" value={teamMember.email} onChange={e => updateTeamMember({email: e.target.value})} placeholder="email@example.com" error={errors.email} />
                <FormInput label="Phone" value={teamMember.phone} onChange={e => updateTeamMember({phone: formatPhone(e.target.value)})} placeholder="(555) 555-5555" />
              </div>
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <FormInput label="First Name" required value={teamMember.firstName} onChange={e => updateTeamMember({firstName: e.target.value})} placeholder="First name" error={errors.firstName} />
                <FormInput label="Last Name" required value={teamMember.lastName} onChange={e => updateTeamMember({lastName: e.target.value})} placeholder="Last name" error={errors.lastName} />
              </div>
              <div className="border-t border-gray-200 pt-6">
                <h3 className="text-lg font-semibold text-gray-900 mb-4">Roles</h3>
                <div className="grid grid-cols-2 md:grid-cols-3 gap-3">
                  {[{key:'administrator',label:'Administrator'},{key:'branchAdmin',label:'Branch Admin'},{key:'salesperson',label:'Salesperson'},{key:'projectManager',label:'Project Manager'},{key:'jobCosting',label:'Job Costing'},{key:'chat',label:'Chat'}].map(role => (
                    <label key={role.key} className="flex items-center gap-2 cursor-pointer">
                      <input type="checkbox" checked={teamMember.roles[role.key]} onChange={e => updateTeamMember({roles: {...teamMember.roles, [role.key]: e.target.checked}})} className="w-4 h-4 text-purple-600 rounded border-gray-300 focus:ring-purple-500" />
                      <span className="text-sm text-gray-700">{role.label}</span>
                    </label>
                  ))}
                </div>
              </div>
              <div className="bg-amber-50 border border-amber-200 rounded-lg p-4 flex items-start gap-3">
                <Icon name="AlertTriangle" size={20} className="text-amber-600 flex-shrink-0 mt-0.5" />
                <p className="text-sm text-amber-800"><strong>Note:</strong> Each additional user costs $50.00/month</p>
              </div>
              <div className="flex justify-between items-center pt-4 border-t">
                <button onClick={() => setSelectedOption(null)} className="text-gray-500 hover:text-gray-700 underline text-sm">Back to Options</button>
                <div className="flex gap-3">
                  <button onClick={onBack} className="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">Cancel</button>
                  <button onClick={() => { if (validate()) { setData({...data, teamMember: {...teamMember, added: true}}); onNext(); }}} className="bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg font-medium">Add Team Member</button>
                </div>
              </div>
            </div>
          )}

          {selectedOption === null && (
            <div className="flex justify-between"><button onClick={onBack} className="bg-white border-2 border-gray-300 hover:border-gray-400 text-gray-700 px-6 py-3 rounded-lg font-medium transition-colors">Back</button></div>
          )}
        </div>
      );
    };

    // Step 6: Create & Send Proposal (was Step 7)
    const Step6Proposal = ({ data, setData, onNext, onBack }) => {
      const [selectedOption, setSelectedOption] = useState(1);
      const [showProposal, setShowProposal] = useState(false);
      const [sending, setSending] = useState(false);
      const [sent, setSent] = useState(false);
      const [lineItems, setLineItems] = useState([]);
      const [showAddItemModal, setShowAddItemModal] = useState(false);
      const [selectedProduct, setSelectedProduct] = useState('');
      const [editingItemIndex, setEditingItemIndex] = useState(null);

      const products = data.products || [
        { name: "Exterior Paint", price: 3500, checked: true },
        { name: "Interior Paint", price: 2500, checked: true },
        { name: "Trim Work", price: 800, checked: true }
      ];
      const checkedProducts = products.filter(p => p.checked);
      const allProducts = [...checkedProducts, { name: "General Prep", price: 500, checked: true }, { name: "Interior Painting - Ceiling", price: 1200, checked: true }, { name: "Interior Painting - Doors", price: 800, checked: true }];
      // Auto-populate test contact for practice proposal
      const lead = { firstName: "Test", lastName: "Contact", phone: "(555) 000-1234", streetAddress: "123 Test Street", city: "Atlanta", state: "GA", zipCode: "30301", email: "test@dripjobs.com" };
      const leadName = `${lead.firstName} ${lead.lastName}`;
      const proposalNumber = 1042857;

      const handleSend = () => {
        doSend();
      };

      const doSend = () => {
        setSending(true);
        setTimeout(() => { setSending(false); setSent(true); setData({...data, proposalSent: true}); setTimeout(() => onNext(), 2000); }, 1000);
      };

      const handleAddLineItem = () => {
        if (selectedProduct) {
          const product = allProducts.find(p => p.name === selectedProduct);
          if (product) {
            if (editingItemIndex !== null) {
              const updated = [...lineItems];
              updated[editingItemIndex] = product;
              setLineItems(updated);
            } else {
              setLineItems([...lineItems, product]);
            }
          }
        }
        setEditingItemIndex(null);
        setShowAddItemModal(false);
      };

      const handleEditItem = (idx) => {
        setEditingItemIndex(idx);
        setSelectedProduct(lineItems[idx].name);
        setShowAddItemModal(true);
      };

      const handleRemoveItem = (idx) => {
        setLineItems(lineItems.filter((_, i) => i !== idx));
      };

      const lineItemsTotal = lineItems.reduce((sum, item) => sum + (item.descriptionOnly ? 0 : item.price), 0);

      if (sent) return (
        <div className="flex flex-col items-center justify-center py-20 fade-in">
          <div className="w-20 h-20 bg-green-500 rounded-full flex items-center justify-center mb-6 checkmark-animate"><Icon name="Check" size={40} className="text-white" /></div>
          <h2 className="text-2xl font-bold text-gray-900 mb-2">Proposal Sent!</h2>
          <p className="text-gray-600">Your proposal has been sent via email.</p>
        </div>
      );

      return (
        <div className="space-y-6">
          <div><h1 className="text-3xl font-bold text-gray-900">Create Your First Proposal</h1></div>

          {!showProposal && (
            <>
              <HelperTip>Final step! Choose an option to create your first proposal. We recommend a <strong>test proposal</strong> to explore how everything works.</HelperTip>
              <div className="space-y-4">
                {[
                  { id: 1, icon: "FlaskConical", title: "Practice with a test proposal", desc: "Create a test proposal using a sample contact (Test Contact)" },
                  { id: 2, icon: "FastForward", title: "I'm not ready for this step yet", desc: "Skip to dashboard and explore on your own" }
                ].map(option => (
                  <div key={option.id} onClick={() => setSelectedOption(option.id)}
                    className={`bg-white rounded-xl shadow-sm border-2 p-5 cursor-pointer transition-all ${selectedOption === option.id ? 'border-purple-500' : 'border-gray-200 hover:border-gray-300'}`}>
                    <div className="flex items-start gap-4">
                      <div className={`w-6 h-6 rounded-full border-2 flex items-center justify-center flex-shrink-0 mt-1 ${selectedOption === option.id ? 'border-purple-600' : 'border-gray-300'}`}>
                        {selectedOption === option.id && <div className="w-3 h-3 rounded-full bg-purple-600" />}
                      </div>
                      <div className="flex-1">
                        <div className="flex items-center gap-3 mb-1"><Icon name={option.icon} size={20} className="text-purple-600" /><h3 className="font-semibold text-gray-900">{option.title}</h3></div>
                        <p className="text-gray-600 text-sm">{option.desc}</p>
                      </div>
                    </div>
                  </div>
                ))}
                <div className="flex justify-between pt-4">
                  <button onClick={onBack} className="bg-white border-2 border-gray-300 hover:border-gray-400 text-gray-700 px-6 py-3 rounded-lg font-medium transition-colors">Back</button>
                  {selectedOption === 2 ? (
                    <button onClick={onNext} className="bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg font-medium transition-colors">Continue to Dashboard</button>
                  ) : (
                    <button onClick={() => setShowProposal(true)} className="bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg font-medium transition-colors">Continue</button>
                  )}
                </div>
              </div>
            </>
          )}

          {showProposal && (
            <div className="bg-white rounded-xl shadow-sm border border-gray-200 fade-in">
              {/* Proposal Header */}
              <div className="p-4 border-b border-gray-200">
                <div className="flex flex-col md:flex-row md:items-start md:justify-between gap-4">
                  <div className="flex items-start gap-3">
                    <div className="w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center"><Icon name="User" size={16} className="text-purple-600" /></div>
                    <div>
                      <h3 className="font-semibold text-purple-600">{leadName}</h3>
                      <p className="text-sm text-gray-500 flex items-center gap-1"><Icon name="MapPin" size={12} /> {lead.streetAddress}, {lead.city}, {lead.state} {lead.zipCode}</p>
                      <p className="text-sm text-gray-500 flex items-center gap-1"><Icon name="Phone" size={12} /> {lead.phone}</p>
                    </div>
                  </div>
                  <div className="text-center">
                    <h2 className="text-xl font-semibold text-gray-900">Proposal #{proposalNumber}</h2>
                    <span className="inline-flex items-center gap-1 px-3 py-1 bg-amber-100 text-amber-700 rounded-full text-sm font-medium mt-1"><Icon name="Clock" size={14} /> PENDING</span>
                  </div>
                  <div className="text-sm text-gray-600 space-y-1">
                    <p><span className="text-gray-400">Created:</span> {new Date().toLocaleDateString()}</p>
                    <p><span className="text-gray-400">Exp. Date:</span> <span className="text-purple-600">Not Set</span></p>
                  </div>
                </div>
              </div>

              {/* Line Items */}
              <div className="p-4 border-b border-gray-200 relative">
                <div className="flex items-start justify-between mb-3"><h4 className="font-semibold text-gray-900">Line Items</h4></div>
                <div className="hidden lg:block absolute -right-4 top-2 z-10 helper-tooltip bg-gradient-to-br from-amber-50 to-yellow-100 border-2 border-amber-300 rounded-xl p-4 max-w-[260px] shadow-lg">
                  <p className="text-sm text-amber-900 flex items-start gap-2 font-medium">
                    <span className="flex-shrink-0 mt-0.5 lightbulb-glow"><Icon name="Lightbulb" size={18} className="text-yellow-500 fill-yellow-300" /></span>
                    Build your first proposal using Line Items. Later you can experiment with areas & packages.
                  </p>
                </div>
                <div className="lg:hidden mb-3 bg-gradient-to-br from-amber-50 to-yellow-100 border-2 border-amber-300 rounded-xl p-3">
                  <p className="text-sm text-amber-900 flex items-start gap-2 font-medium">
                    <span className="flex-shrink-0 mt-0.5 lightbulb-glow"><Icon name="Lightbulb" size={18} className="text-yellow-500 fill-yellow-300" /></span>
                    Build your first proposal using Line Items.
                  </p>
                </div>
                <div className="bg-gray-50 rounded-lg p-4 mb-3">
                  {lineItems.length === 0 ? (
                    <p className="text-gray-500 text-sm flex items-center gap-2"><Icon name="Info" size={16} /> Start by adding Line Items here...</p>
                  ) : (
                    <div className="space-y-2">
                      {lineItems.map((item, idx) => (
                        <div key={idx} className="flex justify-between items-center py-2 border-b border-gray-200 last:border-0 group">
                          <span className="text-gray-700">{item.name}</span>
                          <div className="flex items-center gap-3">
                            <span className="font-medium text-gray-900">${item.price.toLocaleString()}</span>
                            <button onClick={() => handleEditItem(idx)} className="text-purple-600 hover:text-purple-800 text-xs font-medium opacity-0 group-hover:opacity-100 transition-opacity" title="Edit"><Icon name="Pencil" size={14} /></button>
                            <button onClick={() => handleRemoveItem(idx)} className="text-red-500 hover:text-red-700 text-xs font-medium opacity-0 group-hover:opacity-100 transition-opacity" title="Remove"><Icon name="Trash2" size={14} /></button>
                          </div>
                        </div>
                      ))}
                      <div className="flex justify-between items-center pt-2 font-bold">
                        <span className="text-gray-900">Total</span>
                        <span className="text-purple-600">${lineItemsTotal.toLocaleString()}</span>
                      </div>
                    </div>
                  )}
                </div>
                <button onClick={() => { setEditingItemIndex(null); setSelectedProduct(''); setShowAddItemModal(true); }} className="px-3 py-1.5 border border-purple-500 text-purple-600 rounded-lg text-sm font-medium hover:bg-purple-50">Add Item</button>
              </div>

              {/* Add Item Modal */}
              {showAddItemModal && (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                  <div className="bg-white rounded-xl shadow-xl max-w-lg w-full fade-in max-h-[90vh] overflow-y-auto">
                    <div className="flex items-center justify-between p-4 border-b border-gray-200">
                      <h2 className="text-lg font-semibold text-gray-900">{editingItemIndex !== null ? 'Edit Item' : 'Add Item'}</h2>
                      <button onClick={() => setShowAddItemModal(false)} className="text-gray-400 hover:text-gray-600"><Icon name="X" size={20} /></button>
                    </div>
                    <div className="p-4 space-y-4">
                      <div className="bg-purple-50 rounded-lg p-4">
                        <label className="block text-sm font-medium text-gray-700 mb-1">Product or Service</label>
                        <select value={selectedProduct} onChange={e => setSelectedProduct(e.target.value)} className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                          <option value="">Select a product or service...</option>
                          {allProducts.map((p, idx) => <option key={idx} value={p.name}>{p.name}</option>)}
                        </select>
                        {selectedProduct && (
                          <div className="bg-white border border-purple-200 rounded-lg p-2 mt-2 flex justify-between items-center">
                            <span className="text-purple-600 font-medium">{selectedProduct}</span>
                            <span className="font-bold text-gray-900">${allProducts.find(p => p.name === selectedProduct)?.price.toLocaleString() || '0'}</span>
                          </div>
                        )}
                      </div>
                      <div className="bg-purple-100 rounded-lg p-4 text-center">
                        <p className="text-sm text-purple-600 mb-1">Total</p>
                        <p className="text-2xl font-bold text-purple-700">${selectedProduct ? (allProducts.find(p => p.name === selectedProduct)?.price || 0).toLocaleString() : '0.00'}</p>
                      </div>
                    </div>
                    <div className="flex justify-end gap-3 p-4 border-t border-gray-200">
                      <button onClick={handleAddLineItem} disabled={!selectedProduct} className="px-6 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-medium disabled:opacity-50">Save</button>
                      <button onClick={() => setShowAddItemModal(false)} className="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-50">Close</button>
                    </div>
                  </div>
                </div>
              )}

              {/* Footer Actions */}
              <div className="p-4 border-t border-gray-200 bg-gray-50">
                <div className="flex flex-wrap gap-2">
                  <button onClick={handleSend} disabled={sending || lineItems.length === 0}
                    className="px-4 py-2 bg-purple-600 text-white rounded-lg text-sm font-medium hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed">{sending ? "Sending..." : "Send Proposal"}</button>
                  <button className="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg text-sm font-medium hover:bg-gray-100">View/ Edit T&C's</button>
                  <button className="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg text-sm font-medium hover:bg-gray-100">Duplicate</button>
                </div>
                {lineItems.length === 0 && (
                  <p className="text-sm text-amber-600 mt-3 flex items-center gap-1"><Icon name="AlertCircle" size={14} /> Add at least one line item to send the proposal</p>
                )}
              </div>

              <div className="p-4 border-t border-gray-200 flex justify-between">
                <button onClick={() => setShowProposal(false)} className="text-gray-500 hover:text-gray-700 underline text-sm">Back to Options</button>
                <button onClick={onNext} className="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">Skip Proposal</button>
              </div>
            </div>
          )}

        </div>
      );
    };

    // Completion Screen
    const CompletionScreen = ({ data, onViewDashboard }) => {
      const [showConfetti, setShowConfetti] = useState(true);
      useEffect(() => { const t = setTimeout(() => setShowConfetti(false), 3500); return () => clearTimeout(t); }, []);

      return (
        <div className="min-h-[80vh] flex flex-col items-center justify-center text-center px-4 fade-in">
          {showConfetti && <Confetti />}
          <div className="text-6xl mb-6">&#x1F389;</div>
          <h1 className="text-4xl font-bold text-gray-900 mb-4">You're All Set!</h1>
          <p className="text-xl text-gray-600 max-w-lg mb-2">Congratulations on setting up your DripJobs account. You're now ready to grow your business with tools built specifically for contractors like you.</p>

          {/* Completion Summary */}
          <div className="bg-white rounded-xl shadow-sm border border-gray-200 p-6 max-w-md w-full mb-6 text-left">
            <h3 className="font-semibold text-gray-900 mb-4 text-center">Setup Summary</h3>
            <div className="space-y-3">
              {[
                { label: data.scheduledOnboarding ? "Schedule Onboarding Session" : "Schedule Onboarding Session (Skipped)", done: !!data.scheduledOnboarding },
                { label: "Company Settings", done: true },
                { label: "Brand Setup", done: true },
                { label: "Products & Services", done: true },
                { label: "Add-Ons", done: true },
                { label: "Team Members", done: data.teamMember?.added || false },
                { label: "First Proposal", done: data.proposalSent || false }
              ].map((item, i) => (
                <div key={i} className="flex items-center gap-3">
                  <div className={`w-6 h-6 rounded-full flex items-center justify-center ${item.done ? 'bg-green-500' : 'bg-gray-300'}`}>
                    <Icon name={item.done ? "Check" : "Minus"} size={14} className="text-white" />
                  </div>
                  <span className={`text-sm ${item.done ? 'text-gray-900' : 'text-gray-400'}`}>{item.label}</span>
                  {!item.done && !item.label.includes('(Skipped)') && <span className="text-xs text-gray-400">(Skipped)</span>}
                </div>
              ))}
            </div>
          </div>

          {/* Next Steps */}
          <div className="bg-purple-50 border border-purple-200 rounded-xl p-5 max-w-md w-full mb-6">
            <h3 className="font-semibold text-purple-900 mb-3">Recommended Next Steps</h3>
            <div className="space-y-2 text-left">
              {["Connect Google Calendar for appointment sync", "Set up Production Rates for accurate estimating", "Enable Text Messaging for customer communication", "Explore Jobi AI for deal intelligence"].map((item, i) => (
                <div key={i} className="flex items-center gap-2"><Icon name="ArrowRight" size={14} className="text-purple-600" /><span className="text-sm text-purple-800">{item}</span></div>
              ))}
            </div>
          </div>

          {data.scheduledOnboarding && (
            <div className="bg-blue-50 border border-blue-200 rounded-xl p-4 max-w-md w-full mb-6">
              <p className="text-sm text-blue-800 flex items-center gap-2">
                <Icon name="Calendar" size={16} className="text-blue-600" />
                <span>Your onboarding session is scheduled for <strong>{data.scheduledOnboarding.dateStr}</strong> at <strong>{data.scheduledOnboarding.timeStr}</strong></span>
              </p>
            </div>
          )}

          <div className="flex flex-col sm:flex-row gap-4">
            <button onClick={onViewDashboard} className="bg-purple-600 hover:bg-purple-700 text-white px-8 py-4 rounded-lg font-medium text-lg transition-colors">View My Dashboard</button>
            <button className="bg-white border-2 border-purple-500 text-purple-600 hover:bg-purple-50 px-8 py-4 rounded-lg font-medium text-lg transition-colors flex items-center justify-center gap-2">
              <Icon name="Settings" size={20} /> Go to Settings
            </button>
          </div>
        </div>
      );
    };

    // Mock Dashboard
    const MockDashboard = ({ data, onNavigateToStep }) => {
      const lead = { firstName: "Test", lastName: "Contact" };
      const [dismissed, setDismissed] = useState(false);

      const pipelineColumns = [
        { name: 'Cold Leads', color: 'bg-blue-100', textColor: 'text-blue-700', count: 0 },
        { name: 'Warm Leads', color: 'bg-yellow-100', textColor: 'text-yellow-700', count: 1 },
        { name: 'Hot Leads', color: 'bg-orange-100', textColor: 'text-orange-700', count: 0 },
        { name: 'Estimate Requested', color: 'bg-purple-100', textColor: 'text-purple-700', count: 0 },
        { name: 'Estimate Scheduled', color: 'bg-indigo-100', textColor: 'text-indigo-700', count: 0 },
        { name: 'In Draft', color: 'bg-gray-100', textColor: 'text-gray-700', count: data.proposalSent ? 0 : 1 },
        { name: 'Proposal(s) Sent', color: 'bg-green-100', textColor: 'text-green-700', count: data.proposalSent ? 1 : 0 },
        { name: 'Proposal(s) Rejected', color: 'bg-red-100', textColor: 'text-red-700', count: 0 }
      ];

      // ── Onboarding checklist: 7 items (scheduling + 6 setup steps) ──
      const checklistItems = [
        { label: "Schedule Onboarding Session", done: !!data.scheduledOnboarding, icon: "Calendar", step: "schedule_intro" },
        { label: "Company Settings", done: true, icon: "Building2", step: "company_info" },
        { label: "Brand Setup", done: true, icon: "Palette", step: "brand_setup" },
        { label: "Products & Services", done: true, icon: "Package", step: "products" },
        { label: "Platform Add-Ons", done: true, icon: "Puzzle", step: "addons" },
        { label: "Team Members", done: !!data.teamMember?.added, icon: "Users", step: "team" },
        { label: "Send First Proposal", done: !!data.proposalSent, icon: "FileText", step: "proposal" }
      ];

      const completedCount = checklistItems.filter(i => i.done).length;
      const totalCount = checklistItems.length;
      const pct = Math.round((completedCount / totalCount) * 100);
      const allComplete = completedCount === totalCount;
      const incompleteItems = checklistItems.filter(i => !i.done);
      const firstIncompleteStep = incompleteItems.length > 0 ? incompleteItems[0].step : null;

      return (
        <div className="space-y-4 fade-in -mx-4 sm:-mx-6">

          {/* ── Onboarding Progress Tracker ── */}
          {!dismissed && (
            <div className="px-4 sm:px-6 pt-2">
              <div className={`rounded-xl border-2 overflow-hidden transition-all ${allComplete ? 'border-green-300 bg-gradient-to-br from-green-50 to-emerald-50' : 'border-purple-200 bg-gradient-to-br from-purple-50 to-indigo-50'}`}>
                {/* Header */}
                <div className="px-5 pt-5 pb-3">
                  <div className="flex items-start justify-between">
                    <div className="flex items-center gap-3">
                      <div className={`w-11 h-11 rounded-xl flex items-center justify-center shadow-sm ${allComplete ? 'bg-green-500' : 'bg-purple-600'}`}>
                        <Icon name={allComplete ? "PartyPopper" : "Rocket"} size={22} className="text-white" />
                      </div>
                      <div>
                        <h3 className="font-bold text-gray-900 text-base">
                          {allComplete ? 'Setup Complete!' : 'Finish Setting Up Your Account'}
                        </h3>
                        <p className="text-sm text-gray-500 mt-0.5">
                          {allComplete
                            ? 'You\'ve completed all onboarding steps. You\'re ready to go!'
                            : `${completedCount} of ${totalCount} steps complete — ${pct}% done`
                          }
                        </p>
                      </div>
                    </div>
                    {allComplete && (
                      <button onClick={() => setDismissed(true)}
                        className="text-gray-400 hover:text-gray-600 p-1 rounded-lg hover:bg-white/60 transition-colors" title="Dismiss">
                        <Icon name="X" size={18} />
                      </button>
                    )}
                  </div>

                  {/* Progress Bar */}
                  <div className="mt-4 mb-1">
                    <div className="w-full bg-white/70 rounded-full h-2.5 shadow-inner">
                      <div className={`h-2.5 rounded-full transition-all duration-700 ${allComplete ? 'bg-green-500' : 'bg-purple-600'}`}
                        style={{ width: `${pct}%` }} />
                    </div>
                    <div className="flex justify-between mt-1">
                      <span className={`text-xs font-semibold ${allComplete ? 'text-green-700' : 'text-purple-700'}`}>{pct}%</span>
                      <span className="text-xs text-gray-400">{completedCount}/{totalCount} steps</span>
                    </div>
                  </div>
                </div>

                {/* Checklist — only show remaining (incomplete) items */}
                <div className="px-5 pb-4">
                  <div className="grid grid-cols-1 sm:grid-cols-2 gap-2">
                    {incompleteItems.map((item, i) => (
                      <div key={i}
                        className="flex items-center gap-3 px-3 py-2.5 rounded-lg transition-all bg-white border border-gray-200 shadow-sm cursor-pointer hover:border-purple-300 hover:shadow-md"
                        onClick={() => { if (onNavigateToStep) onNavigateToStep(item.step); }}
                      >
                        <div className="w-7 h-7 rounded-full flex items-center justify-center flex-shrink-0 bg-gray-200">
                          <Icon name={item.icon} size={14} className="text-gray-500" />
                        </div>
                        <span className="text-sm text-gray-900 font-medium">{item.label}</span>
                        <Icon name="ChevronRight" size={14} className="text-gray-400 ml-auto" />
                      </div>
                    ))}
                  </div>
                </div>

                {/* Action Bar */}
                <div className={`px-5 py-3 border-t ${allComplete ? 'bg-green-100/50 border-green-200' : 'bg-purple-100/50 border-purple-200'}`}>
                  {allComplete ? (
                    <div className="flex items-center justify-between">
                      <p className="text-sm text-green-800 flex items-center gap-2">
                        <Icon name="Sparkles" size={16} className="text-green-600" />
                        All steps complete — you're all set to start winning jobs!
                      </p>
                      <button onClick={() => setDismissed(true)}
                        className="px-4 py-2 bg-white border border-green-300 text-green-700 rounded-lg text-sm font-medium hover:bg-green-50 transition-colors">
                        Dismiss
                      </button>
                    </div>
                  ) : (
                    <div className="flex items-center justify-between">
                      <p className="text-sm text-purple-800">
                        <strong>{totalCount - completedCount} step{totalCount - completedCount > 1 ? 's' : ''}</strong> remaining to complete setup
                      </p>
                      <button onClick={() => { if (firstIncompleteStep && onNavigateToStep) onNavigateToStep(firstIncompleteStep); }}
                        className="px-5 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg text-sm font-semibold transition-colors flex items-center gap-2 shadow-sm">
                        Continue Setup <Icon name="ArrowRight" size={16} />
                      </button>
                    </div>
                  )}
                </div>
              </div>
            </div>
          )}

          <div className="px-4 sm:px-6">
            <h1 className="text-2xl font-bold text-gray-900">Sales Pipeline</h1>
            <div className="flex items-center gap-4 text-sm text-gray-600 mt-1"><span>Total Deals: <strong>1</strong></span><span>Total Value: <strong>${data.proposalSent ? '6,800.00' : '0.00'}</strong></span></div>
          </div>
          <div className="px-4 sm:px-6 py-3 bg-white border-y border-gray-200">
            <div className="flex flex-wrap items-center gap-2">
              <button className="px-3 py-1.5 bg-purple-600 text-white rounded-lg text-sm font-medium flex items-center gap-1"><Icon name="Plus" size={14} /> New Proposal</button>
              <button className="px-3 py-1.5 border border-gray-300 text-gray-700 rounded-lg text-sm font-medium flex items-center gap-1"><Icon name="Calendar" size={14} /> New Appointment</button>
            </div>
          </div>
          <div className="px-4 sm:px-6 overflow-x-auto">
            <div className="flex gap-3 min-w-max pb-4">
              {pipelineColumns.map(col => (
                <div key={col.name} className="w-48 flex-shrink-0">
                  <div className={`${col.color} rounded-t-lg px-3 py-2 flex items-center justify-between`}>
                    <span className={`font-medium text-sm ${col.textColor}`}>{col.name}</span>
                    <span className={`text-sm ${col.textColor}`}>{col.count}</span>
                  </div>
                  <div className="bg-gray-50 rounded-b-lg p-2 min-h-[300px]">
                    {((col.name === 'Warm Leads') || (col.name === 'In Draft' && !data.proposalSent) || (col.name === 'Proposal(s) Sent' && data.proposalSent)) && (
                      <div className="bg-white rounded-lg shadow-sm border border-gray-200 p-3 mb-2">
                        <div className="flex items-start justify-between mb-2">
                          <span className="font-medium text-gray-900 text-sm">{lead.firstName} {lead.lastName}</span>
                          <button className="text-gray-400"><Icon name="MoreHorizontal" size={14} /></button>
                        </div>
                        <p className="text-xs text-gray-500 mb-2">Website</p>
                        {(col.name !== 'Warm Leads') && (
                          <div className="text-right mb-2"><span className="text-lg font-bold text-gray-900">${data.proposalSent ? '6,800.00' : '0.00'}</span></div>
                        )}
                        <div className="flex items-center justify-between pt-2 border-t border-gray-100">
                          <span className="text-xs text-gray-500">You</span>
                          <span className="text-xs text-gray-400">Updated just now</span>
                        </div>
                      </div>
                    )}
                    {!((col.name === 'Warm Leads') || (col.name === 'In Draft' && !data.proposalSent) || (col.name === 'Proposal(s) Sent' && data.proposalSent)) && col.count === 0 && (
                      <div className="flex flex-col items-center justify-center h-32 text-gray-400"><Icon name="Inbox" size={24} /><p className="text-xs mt-1">No Deals</p></div>
                    )}
                  </div>
                </div>
              ))}
            </div>
          </div>
        </div>
      );
    };

    // ═══════════════════════════════════════════════════
    // MAIN APP — Orchestrates both flows
    // ═══════════════════════════════════════════════════

    const STEPS = {
      WELCOME: 'welcome',
      SCHEDULE_INTRO: 'schedule_intro',
      CALENDAR: 'calendar',
      BOOKING_CONFIRMED: 'booking_confirmed',
      SKIP_SCHEDULING: 'skip_scheduling',
      // Setup Wizard (Flow 1)
      COMPANY_INFO: 'company_info',
      BRAND_SETUP: 'brand_setup',
      PRODUCTS: 'products',
      ADDONS: 'addons',
      TEAM: 'team',
      PROPOSAL: 'proposal',
      COMPLETE: 'complete',
      DASHBOARD: 'dashboard'
    };

    const STEP_ORDER = [
      STEPS.WELCOME, STEPS.SCHEDULE_INTRO, STEPS.CALENDAR, STEPS.BOOKING_CONFIRMED, STEPS.SKIP_SCHEDULING,
      STEPS.COMPANY_INFO, STEPS.BRAND_SETUP, STEPS.PRODUCTS, STEPS.ADDONS, STEPS.TEAM, STEPS.PROPOSAL, STEPS.COMPLETE, STEPS.DASHBOARD
    ];

    const DripJobsHybridOnboarding = () => {
      const [currentStep, setCurrentStep] = useState(STEPS.WELCOME);
      const [direction, setDirection] = useState('right');
      const [errors, setErrors] = useState({});
      const [booking, setBooking] = useState(null);

      const [formData, setFormData] = useState({
        companyName: "", shortName: "", businessType: "Painting", timeZone: "EST",
        streetAddress: "", city: "", state: "", zipCode: "", phone: "", licenseNumber: "",
        googleCalendar: false, brandFinderUsed: false, logoFile: "", accentColor: "#7C3AED",
        websiteUrl: "", reviewUrl: "", facebookUrl: "", instagramUrl: "", linkedinUrl: "", xUrl: "",
        products: null, addOns: { productionRates: false, jobiAI: false, jobCosting: false },
        teamMember: null, proposalSent: false, scheduledOnboarding: null
      });

      const goTo = (step) => {
        const oldIdx = STEP_ORDER.indexOf(currentStep);
        const newIdx = STEP_ORDER.indexOf(step);
        setDirection(newIdx >= oldIdx ? 'right' : 'left');
        setErrors({});
        setCurrentStep(step);
      };

      // ── Resume Mode: when returning from dashboard to complete skipped steps ──
      const [resumeMode, setResumeMode] = useState(false);

      // Given a step the user just completed/skipped past, find the next incomplete step
      const getNextIncompleteStep = (movingPastStep) => {
        const skippableSteps = [
          { step: STEPS.SCHEDULE_INTRO, done: movingPastStep === STEPS.SCHEDULE_INTRO || !!formData.scheduledOnboarding },
          { step: STEPS.TEAM, done: movingPastStep === STEPS.TEAM || !!formData.teamMember?.added },
          { step: STEPS.PROPOSAL, done: movingPastStep === STEPS.PROPOSAL || !!formData.proposalSent }
        ];
        const afterIdx = skippableSteps.findIndex(s => s.step === movingPastStep);
        for (let i = afterIdx + 1; i < skippableSteps.length; i++) {
          if (!skippableSteps[i].done) return skippableSteps[i].step;
        }
        return STEPS.DASHBOARD;
      };

      // Setup wizard step numbers (for progress bar)
      const setupStepNames = ["Company Information", "Brand Setup", "Products & Services", "Platform Add-Ons", "Team Members", "Send Proposal"];
      const setupSteps = [STEPS.COMPANY_INFO, STEPS.BRAND_SETUP, STEPS.PRODUCTS, STEPS.ADDONS, STEPS.TEAM, STEPS.PROPOSAL];
      const currentSetupStep = setupSteps.indexOf(currentStep) + 1;
      const isInSetupWizard = setupSteps.includes(currentStep);
      const isInScheduling = [STEPS.SCHEDULE_INTRO, STEPS.CALENDAR, STEPS.BOOKING_CONFIRMED, STEPS.SKIP_SCHEDULING].includes(currentStep);

      // Demo Controls
      const [demoOpen, setDemoOpen] = useState(false);
      const DemoControls = () => (
        <div className="demo-controls">
          <div className="demo-controls-toggle" onClick={() => setDemoOpen(!demoOpen)}>
            <span className="text-xs text-gray-400 font-semibold">PROTOTYPE NAV</span>
            <span className="toggle-chevron text-gray-400 text-xs">{demoOpen ? '▲ Close' : '▼ Open'}</span>
          </div>
          <div className={`demo-controls-body ${demoOpen ? 'open' : ''}`}>
            <div className="flex flex-wrap items-center gap-1">
              <span className="text-xs text-blue-400 font-semibold mr-1">Scheduling:</span>
              {[
                { step: STEPS.WELCOME, label: "Welcome" },
                { step: STEPS.SCHEDULE_INTRO, label: "Video/CTA" },
                { step: STEPS.CALENDAR, label: "Calendar" },
                { step: STEPS.BOOKING_CONFIRMED, label: "Confirmed" },
                { step: STEPS.SKIP_SCHEDULING, label: "Skip" },
              ].map(s => (
                <button key={s.step} className={`btn ${currentStep === s.step ? 'scheduling' : ''}`} onClick={() => { goTo(s.step); setDemoOpen(false); }}>{s.label}</button>
              ))}
              <span className="text-xs text-purple-400 font-semibold ml-2 mr-1">Setup:</span>
              {[
                { step: STEPS.COMPANY_INFO, label: "1. Company" },
                { step: STEPS.BRAND_SETUP, label: "2. Brand" },
                { step: STEPS.PRODUCTS, label: "3. Products" },
                { step: STEPS.ADDONS, label: "4. Add-Ons" },
                { step: STEPS.TEAM, label: "5. Team" },
                { step: STEPS.PROPOSAL, label: "6. Proposal" },
                { step: STEPS.COMPLETE, label: "Complete" },
                { step: STEPS.DASHBOARD, label: "Dashboard" },
              ].map(s => (
                <button key={s.step} className={`btn ${currentStep === s.step ? 'setup' : ''}`} onClick={() => { goTo(s.step); setDemoOpen(false); }}>{s.label}</button>
              ))}
            </div>
            <div className="text-xs text-gray-500 mt-1">Clickable Prototype — Flow 2 (Scheduling) → Flow 1 (Account Setup, 6 steps) | Owner-only | Custom modals, not redirects</div>
          </div>
        </div>
      );

      // Full-screen steps (Welcome)
      if (currentStep === STEPS.WELCOME) {
        return (
          <div className="demo-content-offset">
            <DemoControls />
            <WelcomeScreen onStart={() => goTo(STEPS.SCHEDULE_INTRO)} />
          </div>
        );
      }

      // Main layout with header + progress
      const renderContent = () => {
        const animClass = direction === 'right' ? 'slide-enter-right' : 'slide-enter-left';
        return (
          <div key={currentStep} className={animClass}>
            {currentStep === STEPS.SCHEDULE_INTRO && (
              <ScheduleOnboardingScreen
                onSchedule={() => goTo(STEPS.CALENDAR)}
                onSkip={() => goTo(STEPS.SKIP_SCHEDULING)}
              />
            )}
            {currentStep === STEPS.CALENDAR && (
              <CalendarSchedulingScreen
                onConfirm={(b) => { setBooking(b); setFormData({...formData, scheduledOnboarding: b}); goTo(STEPS.BOOKING_CONFIRMED); }}
                onBack={() => goTo(STEPS.SCHEDULE_INTRO)}
              />
            )}
            {currentStep === STEPS.BOOKING_CONFIRMED && (
              <BookingConfirmationScreen
                booking={booking}
                onContinue={() => resumeMode ? goTo(getNextIncompleteStep(STEPS.SCHEDULE_INTRO)) : goTo(STEPS.COMPANY_INFO)}
              />
            )}
            {currentStep === STEPS.SKIP_SCHEDULING && (
              <SkipSchedulingScreen
                onContinue={() => resumeMode ? goTo(getNextIncompleteStep(STEPS.SCHEDULE_INTRO)) : goTo(STEPS.COMPANY_INFO)}
                onGoBack={() => goTo(STEPS.SCHEDULE_INTRO)}
              />
            )}
            {currentStep === STEPS.COMPANY_INFO && (
              <Step1CompanyInfo data={formData} setData={setFormData}
                onNext={() => goTo(STEPS.BRAND_SETUP)}
                onBack={() => goTo(booking ? STEPS.BOOKING_CONFIRMED : STEPS.SKIP_SCHEDULING)}
                errors={errors} setErrors={setErrors} />
            )}
            {currentStep === STEPS.BRAND_SETUP && (
              <Step2BrandSetup data={formData} setData={setFormData}
                onNext={() => goTo(STEPS.PRODUCTS)} onBack={() => goTo(STEPS.COMPANY_INFO)} />
            )}
            {currentStep === STEPS.PRODUCTS && (
              <Step3Products data={formData} setData={setFormData}
                onNext={() => goTo(STEPS.ADDONS)} onBack={() => goTo(STEPS.BRAND_SETUP)} />
            )}
            {currentStep === STEPS.ADDONS && (
              <Step4AddOns data={formData} setData={setFormData}
                onNext={() => goTo(STEPS.TEAM)} onBack={() => goTo(STEPS.PRODUCTS)} />
            )}
            {currentStep === STEPS.TEAM && (
              <Step5TeamMembers data={formData} setData={setFormData}
                onNext={() => resumeMode ? goTo(getNextIncompleteStep(STEPS.TEAM)) : goTo(STEPS.PROPOSAL)}
                onBack={() => resumeMode ? goTo(STEPS.DASHBOARD) : goTo(STEPS.ADDONS)} />
            )}
            {currentStep === STEPS.PROPOSAL && (
              <Step6Proposal data={formData} setData={setFormData}
                onNext={() => resumeMode ? goTo(STEPS.DASHBOARD) : goTo(STEPS.COMPLETE)}
                onBack={() => resumeMode ? goTo(STEPS.DASHBOARD) : goTo(STEPS.TEAM)} />
            )}
            {currentStep === STEPS.COMPLETE && (
              <CompletionScreen data={formData} onViewDashboard={() => goTo(STEPS.DASHBOARD)} />
            )}
            {currentStep === STEPS.DASHBOARD && (
              <MockDashboard data={formData} onNavigateToStep={(step) => { setResumeMode(true); goTo(step); }} />
            )}
          </div>
        );
      };

      return (
        <div className="min-h-screen bg-gray-50" className="demo-content-offset">
          <DemoControls />

          {/* Header */}
          <header className="bg-white border-b border-gray-200">
            <div className="max-w-4xl mx-auto px-4 sm:px-6 py-4">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-3"><DripJobsLogo size={40} /><span className="text-xl font-bold text-gray-900">DripJobs</span></div>
                {isInSetupWizard && (
                  <div className="flex items-center gap-2 text-sm text-gray-500">
                    <Icon name="User" size={16} />
                    <span>Account Owner</span>
                  </div>
                )}
              </div>
            </div>
          </header>

          {/* Progress Bar — Shows for scheduling and setup phases */}
          {isInScheduling && (
            <ProgressBar
              currentStep={[STEPS.SCHEDULE_INTRO, STEPS.CALENDAR, STEPS.BOOKING_CONFIRMED, STEPS.SKIP_SCHEDULING].indexOf(currentStep) + 1}
              totalSteps={8}
              stepNames={["Schedule Onboarding", "Pick Date & Time", "Confirmation", "Skipped"]}
              onBack={() => {
                if (currentStep === STEPS.CALENDAR) goTo(STEPS.SCHEDULE_INTRO);
                else if (currentStep === STEPS.SKIP_SCHEDULING) goTo(STEPS.SCHEDULE_INTRO);
              }}
              isSchedulingPhase={true}
            />
          )}
          {isInSetupWizard && (
            <ProgressBar
              currentStep={currentSetupStep}
              totalSteps={6}
              stepNames={setupStepNames}
              onBack={() => {
                const idx = setupSteps.indexOf(currentStep);
                if (idx > 0) goTo(setupSteps[idx - 1]);
              }}
              isSchedulingPhase={false}
            />
          )}

          {/* Main Content */}
          <main className="max-w-4xl mx-auto px-4 sm:px-6 py-8">
            {renderContent()}
          </main>
        </div>
      );
    };

    // Render
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<DripJobsHybridOnboarding />);
  </script>
</body>
</html>
